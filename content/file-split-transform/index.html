
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Split and Transform Files · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../rest-split-transform-amq/" />
    
    
    <link rel="prev" href="../labs.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    INTRODUCTION
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../fuse/">
            
                <a href="../fuse/">
            
                    
                    Fuse 7
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../fuse/software.html">
            
                <a href="../fuse/software.html">
            
                    
                    软件安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../labs.html">
            
                <a href="../labs.html">
            
                    
                    LABS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.2.2.1" data-path="./">
            
                <a href="./">
            
                    
                    Split and Transform Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../rest-split-transform-amq/">
            
                <a href="../rest-split-transform-amq/">
            
                    
                    Split and Transform REST
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../rest-publish-and-fix-errors/">
            
                <a href="../rest-publish-and-fix-errors/">
            
                    
                    Publish Records and Fix Errors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../enrich-content-rest-and-ws-microservices/">
            
                <a href="../enrich-content-rest-and-ws-microservices/">
            
                    
                    Enrich Content and Aggregate Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../legacy-soap-rest-wrapper/">
            
                <a href="../legacy-soap-rest-wrapper/">
            
                    
                    Migrate Legacy SOAP Services
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../3scale/readme.html">
            
                <a href="../3scale/readme.html">
            
                    
                    3Scale
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../3scale/foundations.html">
            
                <a href="../3scale/foundations.html">
            
                    
                    基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="../3scale/admin-portal.html">
            
                <a href="../3scale/admin-portal.html">
            
                    
                    管理门户
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="../3scale/manage-api.html">
            
                <a href="../3scale/manage-api.html">
            
                    
                    API 管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="../3scale/application-plans.html">
            
                <a href="../3scale/application-plans.html">
            
                    
                    应用计划
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="../3scale/appdoc.html">
            
                <a href="../3scale/appdoc.html">
            
                    
                    开发者门户
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../3scale/backend-services.html">
            
                <a href="../3scale/backend-services.html">
            
                    
                    微服务管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../3scale/api/readme.html">
            
                <a href="../3scale/api/readme.html">
            
                    
                    API LIFECYCLE STAGE
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../3scale/api/design.html">
            
                <a href="../3scale/api/design.html">
            
                    
                    Design
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../fuse/training.html">
            
                <a href="../fuse/training.html">
            
                    
                    培训
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../fuse/camel-dev.html">
            
                <a href="../fuse/camel-dev.html">
            
                    
                    Camel 开发培训
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../fuse/usecase.html">
            
                <a href="../fuse/usecase.html">
            
                    
                    Spring Boot 集成开发
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Split and Transform Files</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="split-and-transform-files">Split and Transform Files</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">Overview</a></li>
<li><a href="#_goals">Goals</a></li>
<li><a href="#_camelcontext">camelContext</a></li>
<li><a href="#__">&#x672C;&#x5730;&#x8FD0;&#x884C;</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this lab, you develop Camel routes that process CSV files, split them into individual records, and transform them into Java objects that are written as individual JSON files. The transformation is done using the Fuse Integration Editor. You also develop exception handling logic to process incorrectly formatted records.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_goals">Goals</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Build an Apache Camel route that consumes CSV files and transforms the records into Java objects using the Bindy transformation component</p>
</li>
<li>
<p>Split the list of received Java objects and apply a Java-to-Java transformation using the Fuse Integration Editor (from <code>org.acme.Customer</code> to <code>org.globex.Account</code>)</p>
</li>
<li>
<p>Map the fields as defined within the table</p>
</li>
<li>
<p>Transform the <code>org.globex.Account</code> Java objects into individual JSON files</p>
</li>
<li>
<p>Implement the DLQ pattern to move erroneous CSV records into an error folder</p>
</li>
<li>
<p>Design a unit test to validate the data transformations</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="src/img/file-transfer.png" alt="file transfer.png"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_camelcontext">camelContext</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd        http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">camelContext</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_camelContext1&quot;</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://camel.apache.org/schema/spring&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">propertyPlaceholder</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;properties&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;fabric8/route.properties&quot;</span>/&gt;</span>

        <span class="hljs-comment">&lt;!--
             Transformation Endpoint doing csv2java conversion
             Step 1 : csv record is converted java using camel bindy
             Step 2 : Dozer transformation of Customer to Account
             Step 3 : Java to Json conversion using json jackson
        --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">endpoint</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;csv2json&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;dozer:csv2json2?sourceModel=org.acme.Customer&amp;amp;targetModel=org.globex.Account&amp;amp;marshalId=json&amp;amp;unmarshalId=csv&amp;amp;mappingFile=transformation.xml&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dataFormats</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">bindy</span> <span class="hljs-attr">classType</span>=<span class="hljs-string">&quot;org.acme.Customer&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;csv&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Csv&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">json</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;json&quot;</span> <span class="hljs-attr">library</span>=<span class="hljs-string">&quot;Jackson&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dataFormats</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_route1&quot;</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- Consume files from input directory --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">from</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_from1&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;file:?fileName=customers.csv&amp;amp;noop=true&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">onException</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_onException1&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">exception</span>&gt;</span>java.lang.IllegalArgumentException<span class="hljs-tag">&lt;/<span class="hljs-name">exception</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">handled</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">constant</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">constant</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">handled</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_to1&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;file:?fileName=csv-record-${date:now:yyyyMMdd}.txt&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">onException</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">split</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_split1&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">tokenize</span> <span class="hljs-attr">token</span>=<span class="hljs-string">&quot;\n&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_to2&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;csv2json&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_to3&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;file:?fileName=account-${property.CamelSplitIndex}.json&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">split</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">camelContext</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__">&#x672C;&#x5730;&#x8FD0;&#x884C;</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">$ cd file-split-transform/
$ mvn clean install
$ java -jar target/file-split-transform-<span class="hljs-number">1.0</span>.0.jar</code></pre>
</div>
</div>
</div>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../labs.html" class="navigation navigation-prev " aria-label="Previous page: LABS">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../rest-split-transform-amq/" class="navigation navigation-next " aria-label="Next page: Split and Transform REST">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Split and Transform Files","level":"1.2.2.1","depth":3,"next":{"title":"Split and Transform REST","level":"1.2.2.2","depth":3,"path":"rest-split-transform-amq/README.adoc","ref":"rest-split-transform-amq/README.adoc","articles":[]},"previous":{"title":"LABS","level":"1.2.2","depth":2,"path":"labs.adoc","ref":"labs.adoc","articles":[{"title":"Split and Transform Files","level":"1.2.2.1","depth":3,"path":"file-split-transform/README.adoc","ref":"file-split-transform/README.adoc","articles":[]},{"title":"Split and Transform REST","level":"1.2.2.2","depth":3,"path":"rest-split-transform-amq/README.adoc","ref":"rest-split-transform-amq/README.adoc","articles":[]},{"title":"Publish Records and Fix Errors","level":"1.2.2.3","depth":3,"path":"rest-publish-and-fix-errors/README.adoc","ref":"rest-publish-and-fix-errors/README.adoc","articles":[]},{"title":"Enrich Content and Aggregate Data","level":"1.2.2.4","depth":3,"path":"enrich-content-rest-and-ws-microservices/README.adoc","ref":"enrich-content-rest-and-ws-microservices/README.adoc","articles":[]},{"title":"Migrate Legacy SOAP Services","level":"1.2.2.5","depth":3,"path":"legacy-soap-rest-wrapper/README.adoc","ref":"legacy-soap-rest-wrapper/README.adoc","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{"GUID":"na39","OCP_USER_ID":"ksoong-redhat.com","copyrightYear":"2018","copyrightHolder":"Kylin Soong"},"plugins":["collapsible-menu","donate","-sharing","sharing-plus","splitter","back-to-top-button","edit-link"],"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy Kylin Soong 2018","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"collapsible-menu":{},"splitter":{},"search":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"donate":{"alipay":"http://ksoong.org/docs/content/images/alipay.png","alipayText":"支付宝捐赠","button":"赞赏","title":"","wechat":"http://ksoong.org/docs/content/images/wechat.png","wechatText":"微信捐赠"},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"back-to-top-button":{},"sharing":{"weibo":true,"linkedin":true,"google":true,"facebook":true,"all":["facebook","google","linkedin","weibo"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/kylinsoong/fuse-get-started"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css"}},"file":{"path":"file-split-transform/README.adoc","mtime":"2019-01-19T16:08:14.498Z","type":"asciidoc"},"gitbook":{"version":"3.2.3","time":"2019-01-28T14:59:51.030Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

