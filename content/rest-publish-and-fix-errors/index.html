
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Publish Records and Fix Errors · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-donate/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../enrich-content-rest-and-ws-microservices/" />
    
    
    <link rel="prev" href="../rest-split-transform-amq/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    INTRODUCTION
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../fuse/">
            
                <a href="../fuse/">
            
                    
                    Fuse 7
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../fuse/software.html">
            
                <a href="../fuse/software.html">
            
                    
                    软件安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../labs.html">
            
                <a href="../labs.html">
            
                    
                    LABS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../file-split-transform/">
            
                <a href="../file-split-transform/">
            
                    
                    Split and Transform Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../rest-split-transform-amq/">
            
                <a href="../rest-split-transform-amq/">
            
                    
                    Split and Transform REST
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.2.3" data-path="./">
            
                <a href="./">
            
                    
                    Publish Records and Fix Errors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../enrich-content-rest-and-ws-microservices/">
            
                <a href="../enrich-content-rest-and-ws-microservices/">
            
                    
                    Enrich Content and Aggregate Data
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.5" data-path="../legacy-soap-rest-wrapper/">
            
                <a href="../legacy-soap-rest-wrapper/">
            
                    
                    Migrate Legacy SOAP Services
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../3scale/readme.html">
            
                <a href="../3scale/readme.html">
            
                    
                    3Scale
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../3scale/admin-portal.html">
            
                <a href="../3scale/admin-portal.html">
            
                    
                    管理门户
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../3scale/manage-api.html">
            
                <a href="../3scale/manage-api.html">
            
                    
                    API 管理示例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../3scale/application-plans.html">
            
                <a href="../3scale/application-plans.html">
            
                    
                    Application Plans
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Publish Records and Fix Errors</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="publish-records-and-fix-errors">Publish Records and Fix Errors</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">Overview</a></li>
<li><a href="#_goals">Goals</a></li>
<li><a href="#_camelcontext">camelContext</a></li>
<li><a href="#__">&#x672C;&#x5730;&#x6D4B;&#x8BD5;</a></li>
<li><a href="#__openshift">&#x90E8;&#x7F72;&#x5230; OpenShift</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a continue of <strong>Split and Transform Rest</strong>, but publish the individual JSON Account records to message input queues, including an error queue in the event of a processing error. You also develop a strategy to correct erroneous messages and redeliver them.</p>
</div>
<div class="paragraph">
<p>The route implements an interception strategy when <code>IllegalArgumentException</code> is thrown. The erroneous record is published to a special topic and an error code and error message are added.</p>
</div>
<div class="paragraph">
<p>A separate route listens for error messages. When this route is triggered, the erroneous message and message code are saved into an error table with the status of <code>ERROR</code>. To correct the record, you run a script against the error table and modify the status to <code>FIXED</code>. You use another route to poll the database for <code>FIXED</code> records. This route republishes the message on the original queue and updates the status to <code>CLOSED</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_goals">Goals</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Publish records from the processing to an error topic</p>
</li>
<li>
<p>Implement a custom error handling strategy to capture the erroneous messages</p>
</li>
<li>
<p>Fix the messages and republish them</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="src/img/index.png" alt="index.png"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_camelcontext">camelContext</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hljs-attr">xmlns:camel</span>=<span class="hljs-string">&quot;http://camel.apache.org/schema/spring&quot;</span>
    <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd        http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd&quot;</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Define a traditional camel context here --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">camelContext</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;camel&quot;</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://camel.apache.org/schema/spring&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">propertyPlaceholder</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;properties&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;route.properties&quot;</span>/&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">endpoint</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;csv2json&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;dozer:csv2json2?sourceModel=org.acme.Customer&amp;amp;targetModel=org.globex.Account&amp;amp;marshalId=json&amp;amp;unmarshalId=csv&amp;amp;mappingFile=transformation.xml&quot;</span>/&gt;</span>
        <span class="hljs-comment">&lt;!-- CSV Input &amp; JSon OutPut DataFormat --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dataFormats</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">bindy</span> <span class="hljs-attr">classType</span>=<span class="hljs-string">&quot;org.acme.Customer&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;csv&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;Csv&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">json</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;json&quot;</span> <span class="hljs-attr">library</span>=<span class="hljs-string">&quot;Jackson&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dataFormats</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">restConfiguration</span> <span class="hljs-attr">bindingMode</span>=<span class="hljs-string">&quot;off&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">&quot;servlet&quot;</span> <span class="hljs-attr">contextPath</span>=<span class="hljs-string">&quot;/rest&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">rest</span> <span class="hljs-attr">apiDocs</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;rest-entry&quot;</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/service&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">post</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;rest-entry-post&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;/customers&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;direct:inbox&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">post</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">rest</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_injectroute&quot;</span> <span class="hljs-attr">streamCache</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">from</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_fromIR1&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;direct:inbox&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">setExchangePattern</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_setExchangePattern3&quot;</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;InOnly&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_to1&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;amqp:queue:inputQueue&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">transform</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_transform1&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">constant</span>&gt;</span>Processed the customer data<span class="hljs-tag">&lt;/<span class="hljs-name">constant</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">transform</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_route1&quot;</span> <span class="hljs-attr">streamCache</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- Consume files from input directory --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">from</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_from1&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;amqp:queue:inputQueue&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">onException</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_onException1&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">exception</span>&gt;</span>java.lang.IllegalArgumentException<span class="hljs-tag">&lt;/<span class="hljs-name">exception</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">handled</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">constant</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">constant</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">handled</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">log</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_log1&quot;</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;&gt;&gt; Exception : ${body}&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">setExchangePattern</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_setExchangePattern1&quot;</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;InOnly&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_to2&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;direct:error&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">onException</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">split</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_split1&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">tokenize</span> <span class="hljs-attr">token</span>=<span class="hljs-string">&quot;;&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_to3&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;csv2json&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">setExchangePattern</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_setExchangePattern2&quot;</span> <span class="hljs-attr">pattern</span>=<span class="hljs-string">&quot;InOnly&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_to4&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;amqp:queue:accountQueue&quot;</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">log</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_log2&quot;</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;&gt;&gt; Completed JSON: ${body}&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">split</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Publish the error code and error message on a topic --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;direct-error-queue&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">from</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_from2&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;direct:error&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">setHeader</span> <span class="hljs-attr">headerName</span>=<span class="hljs-string">&quot;error-code&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_setHeader1&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">constant</span>&gt;</span>111<span class="hljs-tag">&lt;/<span class="hljs-name">constant</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">setHeader</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">setHeader</span> <span class="hljs-attr">headerName</span>=<span class="hljs-string">&quot;error-message&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_setHeader2&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">simple</span>&gt;</span>${exception.message}<span class="hljs-tag">&lt;/<span class="hljs-name">simple</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">setHeader</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">setHeader</span> <span class="hljs-attr">headerName</span>=<span class="hljs-string">&quot;message&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_setHeader3&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">simple</span>&gt;</span>${body}<span class="hljs-tag">&lt;/<span class="hljs-name">simple</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">setHeader</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">log</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_log3&quot;</span> <span class="hljs-attr">logName</span>=<span class="hljs-string">&quot;org.fuse.usecase&quot;</span>
                <span class="hljs-attr">loggingLevel</span>=<span class="hljs-string">&quot;DEBUG&quot;</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;!!!! ERROR NOTIFICATION SEND&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;error-queue-endpoint&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;amqp:&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Consume the Topic message and publish it into the DB --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;error-queue-sql&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">from</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_from3&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;amqp:&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">log</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_log4&quot;</span> <span class="hljs-attr">logName</span>=<span class="hljs-string">&quot;org.fuse.usecase&quot;</span>
                <span class="hljs-attr">loggingLevel</span>=<span class="hljs-string">&quot;DEBUG&quot;</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;!!!! NOTIFICATION RECEIVED&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">log</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_log5&quot;</span> <span class="hljs-attr">logName</span>=<span class="hljs-string">&quot;org.fuse.usecase&quot;</span>
                <span class="hljs-attr">loggingLevel</span>=<span class="hljs-string">&quot;DEBUG&quot;</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;&gt;&gt; Error code : ${header.error-code}, Error Message : ${header.error-message}&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_to5&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;sql:insert into USECASE.T_ERROR(ERROR_CODE,ERROR_MESSAGE,MESSAGE,STATUS)                      values (:#${header.error-code}, :#${header.error-message}, :#${header.message}, &apos;ERROR&apos;);&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Inject correct record/message and update their status to CLOSE --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sql-queue-input&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">from</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_from4&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;sql:select MESSAGE, ID from USECASE.T_ERROR where STATUS = &apos;FIXED&apos; ?consumer.onConsume=update USECASE.T_ERROR set STATUS=&apos;CLOSE&apos; where ID = :#ID&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">setBody</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_setBody1&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">simple</span>&gt;</span>${body[message]}<span class="hljs-tag">&lt;/<span class="hljs-name">simple</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">setBody</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">log</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_log6&quot;</span> <span class="hljs-attr">message</span>=<span class="hljs-string">&quot;&gt;&gt; Body : ${body}&quot;</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">to</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;_to6&quot;</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;amqp:queue:inputQueue&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">camelContext</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__">&#x672C;&#x5730;&#x6D4B;&#x8BD5;</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title"><strong>1. &#x521B;&#x5EFA;&#x5E76;&#x542F;&#x52A8; AMQ broker</strong></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">$ cd amq-broker-<span class="hljs-number">7.2</span>.2/
$ ./bin/artemis create  --user admin --password password --role admin --allow-anonymous y ./instances/broker1
$ cd instances/broker1/
$ ./bin/artemis run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x542F;&#x52A8; Spring Boot camel route</strong></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">$ cd fuse-get-started/rest-publish-and-fix-errors/
$ mvn spring-boot:run</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x6D4B;&#x8BD5;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">$ curl -k http:<span class="hljs-comment">//localhost:8080/rest/service/customers -X POST  -d &apos;Rotobots,NA,true,Bill,Smith,100 N Park Ave.,Phoenix,AZ,85017,602-555-1100;BikesBikesBikes,NA,true,George,Jungle,1101 Smith St.,Raleigh,NC,27519,919-555-0800;CloudyCloud,EU,true,Fred,Quicksand,202 Barney Blvd.,Rock City,MI,19728,313-555-1234;ErrorError,,,EU,true,Fred,Quicksand,202 Barney Blvd.,Rock City,MI,19728,313-555-1234&apos; -H &apos;content-type: text/html&apos;</span>
Processed the customer data</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__openshift">&#x90E8;&#x7F72;&#x5230; OpenShift</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title"><strong>1. &#x90E8;&#x7F72; AMQ</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc new-app --template=amq-broker-72-basic \
   <span class="hljs-_">-e</span> AMQ_PROTOCOL=openwire,amqp,stomp,mqtt,hornetq \
   <span class="hljs-_">-e</span> AMQ_USER=admin \
   <span class="hljs-_">-e</span> AMQ_PASSWORD=password \
   <span class="hljs-_">-e</span> AMQ_ROLE=admin</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>2. &#x90E8;&#x7F72; PostgreSQL</strong></div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ oc new-app \
    <span class="hljs-_">-e</span> POSTGRESQL_USER=postgres \
    <span class="hljs-_">-e</span> POSTGRESQL_PASSWORD=postgres \
    <span class="hljs-_">-e</span> POSTGRESQL_DATABASE=sampledb \
    postgresql-persistent</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>3. &#x8FDE;&#x63A5;&#x5230; PostgreSQL</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">$ oc get pods | grep postgresql
$ oc rsh postgresql-1-wczss
sh-4.2$ createdb -h localhost -p 5432 -U postgres sampledb
sh-4.2$ PGPASSWORD=$POSTGRESQL_PASSWORD psql -h postgresql $POSTGRESQL_DATABASE $POSTGRESQL_USER
psql (9.6.10)
Type &quot;help&quot; for help.

sampledb=#</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>4. &#x521B;&#x5EFA;&#x8868;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">SCHEMA</span> USECASE;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> USECASE.T_ACCOUNT (
    <span class="hljs-keyword">id</span>  <span class="hljs-built_in">SERIAL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
    CLIENT_ID <span class="hljs-built_in">integer</span>,
    SALES_CONTACT <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">30</span>),
    COMPANY_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">50</span>),
    COMPANY_GEO <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">20</span>) ,
    COMPANY_ACTIVE <span class="hljs-built_in">BOOLEAN</span>,
    CONTACT_FIRST_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">35</span>),
    CONTACT_LAST_NAME <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">35</span>),
    CONTACT_ADDRESS <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>),
    CONTACT_CITY <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">40</span>),
    CONTACT_STATE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">40</span>),
    CONTACT_ZIP <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">10</span>),
    CONTACT_EMAIL <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">60</span>),
    CONTACT_PHONE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">35</span>),
    CREATION_DATE <span class="hljs-keyword">TIMESTAMP</span>,
    CREATION_USER <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>)
);
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> USECASE.T_ERROR (
    <span class="hljs-keyword">ID</span> <span class="hljs-built_in">SERIAL</span> PRIMARY <span class="hljs-keyword">KEY</span>,
    ERROR_CODE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    ERROR_MESSAGE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">255</span>),
    MESSAGE <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">512</span>),
    <span class="hljs-keyword">STATUS</span> <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">6</span>)
);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>5. &#x90E8;&#x7F72; Spring Boot camel route</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">$ cd fuse-get-started/rest-publish-and-fix-errors/
$ mvn fabric8:deploy -Popenshift</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>6. &#x6D4B;&#x8BD5;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">$ oc expose svc rest-publish-and-fix-errors
$ curl -k http://rest-publish-and-fix-errors-user4-fuse.apps.0d94.openshift.opentlc.com/rest/service/customers -X POST  -d &apos;Rotobots,NA,true,Bill,Smith,100 N Park Ave.,Phoenix,AZ,85017,602-555-1100;BikesBikesBikes,NA,true,George,Jungle,1101 Smith St.,Raleigh,NC,27519,919-555-0800;CloudyCloud,EU,true,Fred,Quicksand,202 Barney Blvd.,Rock City,MI,19728,313-555-1234;ErrorError,,,EU,true,Fred,Quicksand,202 Barney Blvd.,Rock City,MI,19728,313-555-1234&apos; -H &apos;content-type: text/html&apos;
Processed the customer data</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><strong>7. &#x66F4;&#x65B0;&#x6570;&#x636E;&#x5E93;&#x4E2D; ERROR &#x72B6;&#x6001;</strong></div>
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">sampledb=# SELECT id, error_code, status FROM USECASE.T_ERROR;
 id | error_code | status
----+------------+--------
  1 | 111        | ERROR
(1 row)

sampledb=# UPDATE USECASE.T_ERROR SET STATUS=&apos;FIXED&apos; WHERE ID=1;
UPDATE 1</code></pre>
</div>
</div>
</div>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../rest-split-transform-amq/" class="navigation navigation-prev " aria-label="Previous page: Split and Transform REST">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../enrich-content-rest-and-ws-microservices/" class="navigation navigation-next " aria-label="Next page: Enrich Content and Aggregate Data">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Publish Records and Fix Errors","level":"1.2.2.3","depth":3,"next":{"title":"Enrich Content and Aggregate Data","level":"1.2.2.4","depth":3,"path":"enrich-content-rest-and-ws-microservices/README.adoc","ref":"enrich-content-rest-and-ws-microservices/README.adoc","articles":[]},"previous":{"title":"Split and Transform REST","level":"1.2.2.2","depth":3,"path":"rest-split-transform-amq/README.adoc","ref":"rest-split-transform-amq/README.adoc","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{"GUID":"na39","OCP_USER_ID":"ksoong-redhat.com","copyrightYear":"2018","copyrightHolder":"Kylin Soong"},"plugins":["collapsible-menu","donate","-sharing","sharing-plus","splitter","back-to-top-button","edit-link"],"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright &copy Kylin Soong 2018","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"collapsible-menu":{},"splitter":{},"search":{},"sharing-plus":{"qq":false,"all":["facebook","google","twitter","instapaper","linkedin","pocket","stumbleupon"],"douban":false,"facebook":true,"weibo":false,"instapaper":false,"whatsapp":false,"hatenaBookmark":false,"twitter":true,"messenger":false,"line":false,"vk":false,"pocket":true,"google":false,"viber":false,"stumbleupon":false,"qzone":false,"linkedin":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"donate":{"alipay":"http://ksoong.org/docs/content/images/alipay.png","alipayText":"支付宝捐赠","button":"赞赏","title":"","wechat":"http://ksoong.org/docs/content/images/wechat.png","wechatText":"微信捐赠"},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"back-to-top-button":{},"sharing":{"weibo":true,"linkedin":true,"google":true,"facebook":true,"all":["facebook","google","linkedin","weibo"]},"edit-link":{"label":"Edit This Page","base":"https://github.com/kylinsoong/fuse-get-started"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css"}},"file":{"path":"rest-publish-and-fix-errors/README.adoc","mtime":"2019-01-19T16:08:14.516Z","type":"asciidoc"},"gitbook":{"version":"3.2.3","time":"2019-01-20T14:43:19.535Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-donate/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing-plus/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

